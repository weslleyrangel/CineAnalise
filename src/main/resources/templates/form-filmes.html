<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title th:text="${filme.id != null ? 'CineAn√°lise - Editar Filme' : 'CineAn√°lise - Cadastrar Filme'}">CineAn√°lise</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
        <style>
            html {
                transition: background-color 0.3s ease;
            }
            ;
            body {
                font-family: 'VT323', monospace;
                background-color: #C0C0C0;
                color: #000;
            }
            body.dark {
                background-color: #1a1a1a;
                color: #fff;
            }
            .window {
                background-color: #C0C0C0;
                border: 2px outset #fff;
                box-shadow: 2px 2px 0px #000;
                padding: 1rem;
            }
            .window.dark {
                background-color: #2d2d2d;
                border: 2px outset #555;
                box-shadow: 2px 2x 0px #000;
                color: #fff;
            }
            .title-bar {
                background-color: #000080;
                color: #fff;
                padding: 4px 8px;
                font-size: 1.25rem;
                margin-bottom: 1rem;
            }
            .title-bar.dark {
                background-color: #1e3a8a;  /* Azul mais escuro para dark */
            }
            .button {
                background-color: #C0C0C0;
                border: 2px outset #fff;
                box-shadow: 1px 1px 0px #000;
                padding: 0.5rem 1rem;
                font-size: 1.1rem;
                cursor: pointer;
                text-decoration: none;
                display: inline-block;
                color: #000;
            }
            .button.dark {
                background-color: #404040;
                border: 2px outset #666;
                color: #fff;
            }
            .button:active {
                border-style: inset;
            }
            .button-danger {
                background-color: #C00000;
                color: #fff;
            }
            .button-danger.dark {
                background-color: #8B0000;
            }  
            .button-warning {
                background-color: #FFA500;
                color: #000;
            }
            .button-warning.dark {
                background-color: #FF8C00;
                color: #fff;
                background-color: #FF8C00;
            }  
            .input, .textarea, .select {
                background-color: #fff;
                border: 2px inset #808080;
                padding: 0.5rem;
                width: 100%;
                color: #000;
                transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
            }
            .input.dark, .textarea.dark, .select.dark {
                background-color: #555;
                color: #fff;
                border-color: #333;
            }
            .label {
                display: block;
                margin-bottom: 0.5rem;
                font-size: 1.2rem;
                color: inherit;
            }
            .required::after {
                content: " *";
                color: #C00000;
            }
            .filme-card a {
                color: inherit;
            }  
        </style>
    </head>
    <body class="antialiased">

        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="mb-8 text-center">
                <h1 class="text-5xl" style="color: #000080;">CineAn√°lise 95</h1>
                <button id="theme-toggle" class="mt-4 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-black dark:text-white border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    Dark Mode
                </button>
            </header>

            <main class="window">
                <div class="title-bar" th:text="${filme.id != null ? 'Editar Filme' : 'Cadastrar Novo Filme'}"></div>

                <form th:action="${filme.id != null ? '/filmes/editar/' + filme.id : '/filmes'}" 
                      th:object="${filme}" 
                      method="post" 
                      class="p-2">

                    <!-- ID oculto para edi√ß√£o -->
                    <input type="hidden" th:field="*{id}" th:if="${filme.id != null}">

                    <div class="form-group">
                        <label for="titulo" class="label required">T√≠tulo</label>
                        <input type="text" 
                               id="titulo" 
                               th:field="*{titulo}" 
                               required 
                               class="input"
                               placeholder="Ex: Matrix"
                               maxlength="200">
                    </div>

                    <div class="form-group">
                        <label for="sinopse" class="label required">Sinopse</label>
                        <textarea id="sinopse" 
                                  th:field="*{sinopse}" 
                                  rows="5" 
                                  required 
                                  class="textarea"
                                  placeholder="Descreva a hist√≥ria do filme..."
                                  maxlength="2000"></textarea>
                        <p class="text-sm mt-1" style="color: #808080;">M√°ximo 2000 caracteres</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label for="genero" class="label required">G√™nero</label>
                            <input type="text" 
                                   id="genero" 
                                   th:field="*{genero}" 
                                   required 
                                   class="input"
                                   placeholder="Ex: Fic√ß√£o Cient√≠fica"
                                   maxlength="100">
                        </div>

                        <div class="form-group">
                            <label for="ano" class="label required">Ano</label>
                            <input type="number" 
                                   id="ano" 
                                   th:field="*{ano}" 
                                   required 
                                   class="input"
                                   placeholder="Ex: 1999"
                                   min="1900"
                                   max="2100">
                        </div>
                    </div>

                    <div class="flex justify-between items-center pt-4 border-t-2" style="border-color: #808080;">
                        <p class="text-sm" style="color: #808080;">
                            <span class="required"></span> Campos obrigat√≥rios
                        </p>

                        <div class="flex gap-2">
                            <a th:href="@{/filmes}" class="button">‚ùå Cancelar</a>
                            <button type="submit" class="button" style="background-color: #008000; color: #fff;">
                                üíæ <span th:text="${filme.id != null ? 'Atualizar' : 'Salvar'}"></span>
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Informa√ß√£o adicional se for edi√ß√£o -->
                <div th:if="${filme.id != null}" class="mt-4 p-2" style="background-color: #FFFACD; border: 2px solid #FFD700;">
                    <p class="text-sm">
                        ‚ÑπÔ∏è <strong>Aten√ß√£o:</strong> Voc√™ est√° editando o filme "<span th:text="${filme.titulo}"></span>". 
                        As an√°lises existentes n√£o ser√£o afetadas.
                    </p>
                </div>
            </main>
        </div>

        <script>
            // Valida√ß√£o adicional no cliente
            document.querySelector('form').addEventListener('submit', function (e) {
                const ano = document.getElementById('ano').value;
                const anoAtual = new Date().getFullYear();

                if (ano < 1900 || ano > anoAtual + 5) {
                    e.preventDefault();
                    alert('Por favor, insira um ano v√°lido entre 1900 e ' + (anoAtual + 5));
                    return false;
                }
            });

            // Contador de caracteres para sinopse
            const sinopse = document.getElementById('sinopse');
            const contadorDiv = document.createElement('div');
            contadorDiv.className = 'text-sm mt-1';
            contadorDiv.style.color = '#808080';
            sinopse.parentNode.appendChild(contadorDiv);

            function atualizarContador() {
                const restante = 2000 - sinopse.value.length;
                contadorDiv.textContent = restante + ' caracteres restantes';
                contadorDiv.style.color = restante < 100 ? '#C00000' : '#808080';
            }

            sinopse.addEventListener('input', atualizarContador);
            atualizarContador();
        </script>

    </body>
</html>